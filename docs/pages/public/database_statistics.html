<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Statistics - McKnight's American Football</title>
    <meta name="description" content="Statistics about the McKnight's American Football Rankings database, including games collected and data coverage.">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Custom Stylesheet -->
    <link href="/static-football-rankings/css/styles.css" rel="stylesheet">
    
    <!-- Plotly for interactive charts -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js" charset="utf-8"></script>
    
    <style>
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .stat-card h3 {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-card p {
            margin: 0;
            opacity: 0.9;
        }
        
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .section-title {
            margin-top: 40px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
    </style>
</head>
<body>
    <!-- Header Banner -->
    <div class="header-banner">
        <img src="/static-football-rankings/images/football-field-top.jpg" alt="Football Field Header" class="w-100" />
    </div>

    <!-- Breadcrumb navigation -->
    <div class="container mt-3">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/static-football-rankings/">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">Database Statistics</li>
            </ol>
        </nav>
    </div>

    <div class="container mt-4 mb-5">
        <h1 class="text-center mb-4">Database Statistics</h1>
        
        <div class="alert alert-info" role="alert">
            <strong>About This Data:</strong> These statistics show the growth and coverage of the McKnight's American Football Rankings database. 
            The database contains historical high school football game results dating back to 1869, collected from various sources including 
            newspapers, official records, and historical archives.
        </div>

        <!-- Summary Statistics Cards -->
        <h2 class="section-title">Database Overview</h2>
        <div class="row" id="statsCards">
            <!-- Stats will be loaded here dynamically -->
            <div class="col-md-3">
                <div class="stat-card">
                    <h3 id="totalGames">Loading...</h3>
                    <p>Total Games</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <h3 id="totalSeasons">Loading...</h3>
                    <p>Seasons Covered</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <h3 id="seasonRange">Loading...</h3>
                    <p>Year Range</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                    <h3 id="yearsAdding">Loading...</h3>
                    <p>Years Collecting</p>
                </div>
            </div>
        </div>

        <!-- Cumulative Games Chart -->
        <h2 class="section-title">Cumulative Game Collection Progress</h2>
        <div class="chart-container">
            <p class="text-muted mb-3">
                This chart shows the cumulative growth of games in the database, with each color representing games added in different years. 
                The stacked areas illustrate how historical data has been gradually collected and added to the database over time.
            </p>
            <div id="cumulativeChart" style="width: 100%; height: 600px;"></div>
        </div>

        <!-- Annual Additions Chart -->
        <h2 class="section-title">Annual Data Collection Activity</h2>
        <div class="chart-container">
            <p class="text-muted mb-3">
                This chart displays the number of games added to the database each year, showing periods of active data collection 
                and research. Note that NULL date_added values are attributed to 2012.
            </p>
            <div id="annualChart" style="width: 100%; height: 400px;"></div>
        </div>

        <!-- Additional Information -->
        <h2 class="section-title">About the Database</h2>
        <div class="row">
            <div class="col-md-6">
                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title">Data Sources</h5>
                        <p class="card-text">
                            Game data has been collected from various sources including:
                        </p>
                        <ul>
                            <li>Historical newspaper archives (Newspapers.com)</li>
                            <li>State athletic association records</li>
                            <li>MaxPreps and other sports databases</li>
                            <li>Historical society archives</li>
                            <li>School and program records</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title">Data Quality</h5>
                        <p class="card-text">
                            All game results undergo standardization and verification:
                        </p>
                        <ul>
                            <li>Team names are standardized using an alias mapping system</li>
                            <li>Duplicate games are identified and removed</li>
                            <li>OCR results are manually reviewed for accuracy</li>
                            <li>Sources are documented for each game</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="text-center mt-4">
            <p class="text-muted">
                <small>Last Updated: <span id="lastUpdated">Loading...</span></small>
            </p>
        </div>
    </div>

    <!-- Footer -->
    <footer class="mt-5 mb-3">
        <div class="container text-center">
            <p>&copy; 2025 McKnight's Football Rankings</p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Load and display statistics -->
    <script>
        // Load statistics summary
        fetch('/static-football-rankings/data/statistics/statistics_summary.json')
            .then(response => response.json())
            .then(data => {
                // Update stat cards
                document.getElementById('totalGames').textContent = data.total_games.toLocaleString();
                document.getElementById('totalSeasons').textContent = data.total_seasons.toLocaleString();
                document.getElementById('seasonRange').textContent = `${data.earliest_season}-${data.latest_season}`;
                document.getElementById('yearsAdding').textContent = data.years_adding_data;
                document.getElementById('lastUpdated').textContent = new Date(data.last_updated).toLocaleString();
            })
            .catch(error => {
                console.error('Error loading statistics:', error);
                document.getElementById('totalGames').textContent = 'Error';
            });

        // Load cumulative chart
        fetch('/static-football-rankings/data/statistics/cumulative_games.html')
            .then(response => response.text())
            .then(html => {
                // Extract the Plotly data from the HTML
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const scriptTag = doc.querySelector('script[type="text/javascript"]');
                
                if (scriptTag) {
                    // Execute the Plotly code
                    const plotlyCode = scriptTag.textContent;
                    // Extract the plot data and layout
                    const dataMatch = plotlyCode.match(/Plotly\.newPlot\([^,]+,\s*(\[[\s\S]*?\]),\s*(\{[\s\S]*?\})/);
                    
                    if (dataMatch) {
                        const data = eval(dataMatch[1]);
                        const layout = eval(dataMatch[2]);
                        layout.height = 600; // Ensure proper height
                        Plotly.newPlot('cumulativeChart', data, layout, {displayModeBar: true, displaylogo: false});
                    }
                }
            })
            .catch(error => {
                console.error('Error loading cumulative chart:', error);
                document.getElementById('cumulativeChart').innerHTML = '<p class="text-danger">Error loading chart</p>';
            });

        // Load annual additions chart
        fetch('/static-football-rankings/data/statistics/annual_additions.html')
            .then(response => response.text())
            .then(html => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const scriptTag = doc.querySelector('script[type="text/javascript"]');
                
                if (scriptTag) {
                    const plotlyCode = scriptTag.textContent;
                    const dataMatch = plotlyCode.match(/Plotly\.newPlot\([^,]+,\s*(\[[\s\S]*?\]),\s*(\{[\s\S]*?\})/);
                    
                    if (dataMatch) {
                        const data = eval(dataMatch[1]);
                        const layout = eval(dataMatch[2]);
                        layout.height = 400;
                        Plotly.newPlot('annualChart', data, layout, {displayModeBar: true, displaylogo: false});
                    }
                }
            })
            .catch(error => {
                console.error('Error loading annual chart:', error);
                document.getElementById('annualChart').innerHTML = '<p class="text-danger">Error loading chart</p>';
            });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Greatest Games - McKnight's American Football Rankings</title>
    <meta name="description" content="The greatest, most dramatic games in high school football history, ranked by the Pulse Rate Index — a measure of game quality and competitive tension.">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom Stylesheet -->
    <link href="/static-football-rankings/css/styles.css" rel="stylesheet">

    <style>
        /* Decade filter buttons */
        .decade-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 1rem;
        }
        .decade-btn {
            font-size: 0.85rem;
            padding: 4px 12px;
        }
        .decade-btn.active {
            background-color: #0d6efd;
            color: white;
            border-color: #0d6efd;
        }

        /* Score display — bold, compact */
        .score-cell {
            font-weight: 600;
            white-space: nowrap;
            letter-spacing: 0.02em;
        }
        .score-winner {
            color: #155724;
        }
        .score-loser {
            color: #6c757d;
        }

        /* PRI bar visualization */
        .pri-bar-wrap {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .pri-bar {
            height: 8px;
            background: linear-gradient(90deg, #0d6efd, #6610f2);
            border-radius: 4px;
            min-width: 4px;
        }
        .pri-label {
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
            color: #495057;
        }

        /* Methodology section */
        .methodology-card {
            border-left: 4px solid #0d6efd;
            background: #f8f9fa;
        }
        .methodology-card .card-body {
            padding: 1.25rem 1.5rem;
        }
        .limitation-item {
            font-size: 0.9rem;
            color: #495057;
            margin-bottom: 0.4rem;
        }
        .limitation-item::before {
            content: "⚠ ";
            color: #fd7e14;
        }

        /* Rivalries teaser card */
        .coming-soon-card {
            border: 2px dashed #ced4da;
            background: #f8f9fa;
            opacity: 0.85;
        }
        .coming-soon-badge {
            font-size: 0.7rem;
            background: #6c757d;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            vertical-align: middle;
            margin-left: 8px;
        }

        /* Margin badge */
        .margin-badge {
            font-size: 0.75rem;
            font-weight: 600;
            padding: 2px 7px;
            border-radius: 4px;
        }
        .margin-1 { background: #d4edda; color: #155724; }   /* 1pt — maximum drama */
        .margin-2-3 { background: #d1ecf1; color: #0c5460; } /* 2-3pt */
        .margin-4-7 { background: #fff3cd; color: #856404; } /* 4-7pt */
        .margin-8 { background: #f8d7da; color: #721c24; }   /* 8pt */

        /* Rank column */
        .rank-cell {
            font-weight: 700;
            color: #6c757d;
            font-size: 0.9rem;
        }
        .rank-cell.top-10 { color: #0d6efd; }
        .rank-cell.top-25 { color: #198754; }

        /* Table header */
        .table thead th {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #6c757d;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            vertical-align: middle;
        }

        /* Responsive — hide less critical columns on small screens */
        @media (max-width: 768px) {
            .col-margin, .col-pri { display: none; }
        }

        /* Loading state */
        #loadingIndicator {
            text-align: center;
            padding: 3rem;
            color: #6c757d;
        }
        #noResults {
            text-align: center;
            padding: 2rem;
            color: #6c757d;
            display: none;
        }

        /* Last updated */
        .last-updated {
            font-size: 0.8rem;
            color: #6c757d;
        }
    </style>
</head>
<body>

    <!-- Header Banner -->
    <div class="header-banner">
        <img src="/static-football-rankings/images/football-field-top.jpg" alt="Football Field Header" class="w-100" />
    </div>

    <!-- Breadcrumb -->
    <div class="container mt-3">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/static-football-rankings/index.html">Home</a></li>
                <li class="breadcrumb-item"><a href="/static-football-rankings/pages/public/greatest/index.html">Greatest Games &amp; Rivalries</a></li>
                <li class="breadcrumb-item active" aria-current="page">Greatest Games</li>
            </ol>
        </nav>
    </div>

    <div class="container mt-4">

        <!-- Page Header -->
        <div class="d-flex justify-content-between align-items-start mb-2 flex-wrap gap-2">
            <div>
                <h1 class="mb-1">Greatest Games</h1>
                <p class="text-muted mb-0">The most dramatic, highest-quality games in high school football history — 1877 to present</p>
            </div>
            <div class="text-end">
                <span class="last-updated">Last updated: <span id="lastUpdated">—</span></span>
            </div>
        </div>

        <!-- ============================================================
             METHODOLOGY SECTION
             ============================================================ -->
        <div class="card methodology-card mb-4 mt-3">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">How Games Are Ranked</h5>
                    <button class="btn btn-sm btn-outline-secondary" type="button"
                            data-bs-toggle="collapse" data-bs-target="#methodologyBody"
                            aria-expanded="false" aria-controls="methodologyBody">
                        Show / Hide
                    </button>
                </div>

                <div class="collapse" id="methodologyBody">
                    <hr>

                    <h6>The Pulse Rate Index (PRI)</h6>
                    <p>Each game is scored by the <strong>Pulse Rate Index</strong>, which combines two things: how good both teams were, and how close the game was.</p>
                    <p>The formula is:</p>
                    <blockquote class="blockquote fs-6">
                        <code>PRI = (Home Team Rating + Visitor Team Rating) × Margin Multiplier</code>
                    </blockquote>
                    <p>Team ratings use the <strong>Combined Rating</strong> from the end-of-season final (Week 52) — a machine-learning–derived measure of program strength for that season. Only elite programs qualify (see below).</p>
                    <p>The <strong>Margin Multiplier</strong> rewards close games and penalizes comfortable wins:</p>
                    <div class="table-responsive mb-3">
                        <table class="table table-sm table-bordered" style="max-width: 440px;">
                            <thead><tr><th>Margin</th><th>Multiplier</th><th>Reasoning</th></tr></thead>
                            <tbody>
                                <tr><td>Tie</td><td>0.85</td><td>Less decisive than a one-point game</td></tr>
                                <tr><td>1 point</td><td>1.00</td><td>Maximum drama</td></tr>
                                <tr><td>2–3 points</td><td>0.90</td><td>Field goal range</td></tr>
                                <tr><td>4–7 points</td><td>0.75</td><td>One score game</td></tr>
                                <tr><td>8 points</td><td>0.60</td><td>TD + two-point conversion</td></tr>
                                <tr><td>9+ points</td><td>—</td><td>Excluded (not "close" by any standard)</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <h6>Elite Program Filter</h6>
                    <p>To appear in these results, <em>both</em> teams must qualify as elite programs for that season. A team qualifies if it meets all three criteria:</p>
                    <ul>
                        <li>Combined Rating &gt; 20 for that season (approximately top 9% nationally)</li>
                        <li>Five-year rolling average Combined Rating &gt; 20 (sustained excellence, not a one-year wonder)</li>
                        <li>At least 2 seasons of data within the five-year window</li>
                    </ul>
                    <p>This filter ensures that the results represent genuinely elite matchups — not flukes between programs with thin historical records.</p>

                    <h6>The PRI Score Shown in the Table</h6>
                    <p>The PRI score is displayed on a 0–100 scale, where 100 represents the highest-scoring game in the dataset. This makes it easy to compare across eras without needing to interpret the raw formula values.</p>

                    <h6>Known Limitations</h6>
                    <div class="mt-2">
                        <div class="limitation-item">
                            <strong>Early Texas data (pre-1995):</strong> Coverage gaps in early-1990s Texas data compress team ratings for that era. Some historically significant Texas games (including John Tyler vs. Plano East, 1994 — the "61-point game") rank lower than they deserve and will improve as historical data fills in.
                        </div>
                        <div class="limitation-item">
                            <strong>Games with margin &gt; 8 points are excluded</strong> by design, even if they were historically significant matchups. The De La Salle vs. Long Beach Poly rivalry, for example, falls outside the cutoff in most of their meetings.
                        </div>
                        <div class="limitation-item">
                            <strong>Program classification is ongoing:</strong> Some states have not yet completed the team-level classification review to confirm which programs played 11-man vs. 8-man or 9-man football. Results from those states are included but classification is based on best available data. The list improves as state-by-state review progresses.
                        </div>
                        <div class="limitation-item">
                            <strong>Coverage is uneven across eras:</strong> Digitized newspaper archives provide rich pre-1970 coverage for some regions but not others. Ratings for programs in less-covered regions may be compressed.
                        </div>
                    </div>
                </div><!-- /collapse -->
            </div>
        </div><!-- /methodology card -->

        <!-- ============================================================
             FILTER CONTROLS
             ============================================================ -->
        <div class="d-flex flex-wrap align-items-center gap-3 mb-3">
            <div>
                <span class="fw-semibold me-2 text-muted" style="font-size:0.85rem;">FILTER BY DECADE</span>
                <div class="decade-filters d-inline-flex">
                    <button class="btn btn-outline-primary decade-btn active" data-decade="all">All</button>
                    <button class="btn btn-outline-primary decade-btn" data-decade="1870">1870s–1900s</button>
                    <button class="btn btn-outline-primary decade-btn" data-decade="1910">1910s–1930s</button>
                    <button class="btn btn-outline-primary decade-btn" data-decade="1940">1940s–1960s</button>
                    <button class="btn btn-outline-primary decade-btn" data-decade="1970">1970s–1980s</button>
                    <button class="btn btn-outline-primary decade-btn" data-decade="1990">1990s–2000s</button>
                    <button class="btn btn-outline-primary decade-btn" data-decade="2010">2010s–Present</button>
                </div>
            </div>
            <div class="ms-auto">
                <span class="text-muted" style="font-size:0.85rem;" id="resultCount">Showing — games</span>
            </div>
        </div>

        <!-- ============================================================
             MAIN TABLE
             ============================================================ -->
        <div id="loadingIndicator">
            <div class="spinner-border text-primary mb-3" role="status"></div>
            <p>Loading games data…</p>
        </div>

        <div id="tableWrapper" style="display:none;">
            <div class="table-responsive">
                <table class="table table-hover table-sm align-middle" id="gamesTable">
                    <thead>
                        <tr>
                            <th style="width:48px;">#</th>
                            <th style="width:64px;">Season</th>
                            <th>Home Team</th>
                            <th>Visitor Team</th>
                            <th class="text-center" style="width:110px;">Score</th>
                            <th class="text-center col-margin" style="width:72px;">Margin</th>
                            <th class="col-pri" style="width:140px;">PRI Score</th>
                        </tr>
                    </thead>
                    <tbody id="gamesTableBody">
                        <!-- Rows injected by JS -->
                    </tbody>
                </table>
            </div>
            <div id="noResults">No games found for the selected filter.</div>
        </div>

        <!-- ============================================================
             RIVALRIES TEASER
             ============================================================ -->
        <div class="card coming-soon-card mt-5 mb-4">
            <div class="card-body">
                <h5 class="card-title mb-1">
                    Greatest Rivalries
                    <span class="coming-soon-badge">Coming Soon</span>
                </h5>
                <p class="card-text text-muted mb-0">
                    Which two programs have produced the most consistently great, dramatic games against each other over time?
                    Greatest Rivalries will rank head-to-head series by aggregated game quality, weighted by recency and competitive balance —
                    giving a definitive answer to who the best rivalries in high school football history really are.
                </p>
            </div>
        </div>

    </div><!-- /container -->

    <!-- Comments Section -->
    <div class="container">
        <div class="comments-section mt-4">
            <h3>Comments</h3>
            <div id="authContainer" class="mb-3"></div>
            <div id="commentForm" class="mb-4" style="display: none">
                <div class="card">
                    <div class="card-body">
                        <textarea id="commentText" class="form-control mb-2" rows="3"
                                  placeholder="Share your thoughts on the greatest games rankings…"></textarea>
                        <div class="d-flex justify-content-between align-items-center">
                            <button id="submitComment" class="btn btn-primary">Post Comment</button>
                            <small class="text-muted">Posting as <span id="authorName">Anonymous</span></small>
                        </div>
                    </div>
                </div>
            </div>
            <div id="commentsList"></div>
        </div>
    </div>

    <footer class="mt-5 mb-3">
        <div class="text-center">
            <p>© 2025 McKnight's Football Rankings</p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Main JS Module (handles auth/comments banner) -->
    <script type="module" src="/static-football-rankings/js/main.js"></script>

    <!-- Greatest Games Data & Rendering -->
    <script>
    (function () {
        'use strict';

        const DATA_URL = '/static-football-rankings/data/greatest-games/greatest-games.json';

        let allGames = [];
        let activeDecade = 'all';

        // ── Decade range mapping ──────────────────────────────────────────
        const DECADE_RANGES = {
            'all':  [0,    9999],
            '1870': [1877, 1909],
            '1910': [1910, 1939],
            '1940': [1940, 1969],
            '1970': [1970, 1989],
            '1990': [1990, 2009],
            '2010': [2010, 9999],
        };

        // ── Margin badge ──────────────────────────────────────────────────
        function marginClass(margin) {
            const m = Math.abs(margin);
            if (m === 0) return '';
            if (m === 1) return 'margin-1';
            if (m <= 3)  return 'margin-2-3';
            if (m <= 7)  return 'margin-4-7';
            return 'margin-8';
        }

        // ── Rank cell class ───────────────────────────────────────────────
        function rankClass(rank) {
            if (rank <= 10) return 'rank-cell top-10';
            if (rank <= 25) return 'rank-cell top-25';
            return 'rank-cell';
        }

        // ── PRI bar width (0–100 normalised) ─────────────────────────────
        function priBar(pri_normalised) {
            const w = Math.max(4, Math.round(pri_normalised));
            return `<div class="pri-bar-wrap">
                        <div class="pri-bar" style="width:${w}px;"></div>
                        <span class="pri-label">${pri_normalised.toFixed(1)}</span>
                    </div>`;
        }

        // ── Score cell ────────────────────────────────────────────────────
        function scoreCell(homeScore, visitorScore, margin) {
            // margin is home - visitor; positive = home won
            const homeWon = margin >= 0;
            const homeClass  = homeWon  ? 'score-winner' : 'score-loser';
            const visClass   = !homeWon ? 'score-winner' : 'score-loser';
            return `<span class="score-cell ${homeClass}">${homeScore}</span>`
                 + `<span class="text-muted px-1">–</span>`
                 + `<span class="score-cell ${visClass}">${visitorScore}</span>`;
        }

        // ── Build one table row ───────────────────────────────────────────
        function buildRow(g) {
            const absMargin = Math.abs(g.margin);
            const mBadge = `<span class="margin-badge ${marginClass(g.margin)}">${absMargin === 0 ? 'TIE' : absMargin + ' pt'}</span>`;
            return `<tr>
                <td class="${rankClass(g.rank)}">${g.rank}</td>
                <td>${g.season}</td>
                <td>${escapeHtml(g.home_team)}</td>
                <td>${escapeHtml(g.visitor_team)}</td>
                <td class="text-center">${scoreCell(g.home_score, g.visitor_score, g.margin)}</td>
                <td class="text-center col-margin">${mBadge}</td>
                <td class="col-pri">${priBar(g.pri_normalised)}</td>
            </tr>`;
        }

        function escapeHtml(str) {
            const d = document.createElement('div');
            d.textContent = str || '';
            return d.innerHTML;
        }

        // ── Render filtered games ─────────────────────────────────────────
        function render() {
            const [minYear, maxYear] = DECADE_RANGES[activeDecade];
            const filtered = allGames.filter(g => g.season >= minYear && g.season <= maxYear);

            const tbody = document.getElementById('gamesTableBody');
            const noResults = document.getElementById('noResults');
            const count = document.getElementById('resultCount');

            if (filtered.length === 0) {
                tbody.innerHTML = '';
                noResults.style.display = 'block';
            } else {
                noResults.style.display = 'none';
                tbody.innerHTML = filtered.map(buildRow).join('');
            }

            count.textContent = `Showing ${filtered.length} game${filtered.length !== 1 ? 's' : ''}`;
        }

        // ── Decade filter button wiring ───────────────────────────────────
        document.querySelectorAll('.decade-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                document.querySelectorAll('.decade-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                activeDecade = this.dataset.decade;
                render();
            });
        });

        // ── Load JSON data ────────────────────────────────────────────────
        fetch(DATA_URL)
            .then(r => {
                if (!r.ok) throw new Error(`HTTP ${r.status}`);
                return r.json();
            })
            .then(data => {
                allGames = data.items || [];

                // Populate last updated
                if (data.metadata && data.metadata.timestamp) {
                    const d = new Date(data.metadata.timestamp);
                    document.getElementById('lastUpdated').textContent =
                        d.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                }

                document.getElementById('loadingIndicator').style.display = 'none';
                document.getElementById('tableWrapper').style.display = 'block';
                render();
            })
            .catch(err => {
                console.error('Failed to load greatest games data:', err);
                document.getElementById('loadingIndicator').innerHTML =
                    '<p class="text-danger">Unable to load games data. Please try again later.</p>';
            });

    })();
    </script>

    <!-- Comments Script -->
    <div class="container mt-5">
    <div class="comments-section">
        <h3 class="mb-4">Comments & Discussion</h3>
        <p class="text-muted small mb-3">
            Sign in with GitHub to comment. Comments are stored as 
            <a href="https://github.com/olderdyad/static-football-rankings/discussions" target="_blank">GitHub Discussions</a>.
        </p>
        <script src="https://giscus.app/client.js"
                data-repo="olderdyad/static-football-rankings"
                data-repo-id="R_kgDONn_yOg"
                data-category="General"
                data-category-id="DIC_kwDONn_yOs4C0hls"
                data-mapping="pathname"
                data-strict="0"
                data-reactions-enabled="1"
                data-emit-metadata="1"
                data-input-position="top"
                data-theme="preferred_color_scheme"
                data-lang="en"
                data-loading="lazy"
                crossorigin="anonymous"
                async>
        </script>
    </div>
</div>

</body>
</html>
